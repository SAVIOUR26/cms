name: Deploy KandaNews

on:
  push:
    branches: [main]
  workflow_dispatch:

jobs:
  deploy-cms:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Deploy CMS
        uses: SamKirkland/FTP-Deploy-Action@v4.3.5
        with:
          server: ${{ secrets.FTP_HOST }}
          username: ${{ secrets.FTP_USER }}
          password: ${{ secrets.FTP_PASS }}
          local-dir: ./
          server-dir: cms.kandanews.africa/public_html/
          exclude: |
            **/.git*
            **/.git*/**
            .github/**
            landing/**
            backend/**
            wordpress-ref/**
            Kanda Africa/**
            kandanews-ug/**
            api/**
            .env
            .env.example

  deploy-api:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Prepare API
        run: |
          mkdir -p _deploy
          cp -r api/v1/* _deploy/
          cp api/v1/.htaccess _deploy/.htaccess
      - name: Deploy api.kandanews.africa
        uses: SamKirkland/FTP-Deploy-Action@v4.3.5
        with:
          server: ${{ secrets.FTP_HOST }}
          username: ${{ secrets.FTP_USER }}
          password: ${{ secrets.FTP_PASS }}
          local-dir: ./_deploy/
          server-dir: api.kandanews.africa/public_html/
          exclude: |
            schema/**

  deploy-main:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Prepare
        run: |
          mkdir -p _deploy/shared _deploy/blog
          cp -r landing/main/* _deploy/
          cp -r landing/shared/* _deploy/shared/
          cp -r landing/blog/* _deploy/blog/
          cp landing/shared/.htaccess _deploy/.htaccess
      - name: Deploy kandanews.africa
        uses: SamKirkland/FTP-Deploy-Action@v4.3.5
        with:
          server: ${{ secrets.FTP_HOST }}
          username: ${{ secrets.FTP_USER }}
          password: ${{ secrets.FTP_PASS }}
          local-dir: ./_deploy/
          server-dir: kandanews.africa/private_html/

  deploy-ug:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Prepare
        run: |
          mkdir -p _deploy/shared
          cp -r landing/ug/* _deploy/
          cp -r landing/shared/* _deploy/shared/
          cp landing/shared/.htaccess _deploy/.htaccess
      - name: Deploy ug.kandanews.africa
        uses: SamKirkland/FTP-Deploy-Action@v4.3.5
        with:
          server: ${{ secrets.FTP_HOST }}
          username: ${{ secrets.FTP_USER }}
          password: ${{ secrets.FTP_PASS }}
          local-dir: ./_deploy/
          server-dir: ug.kandanews.africa/public_html/

  deploy-ke:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Prepare
        run: |
          mkdir -p _deploy/shared
          cp landing/coming-soon.php _deploy/index.php
          cp -r landing/shared/* _deploy/shared/
          cp landing/shared/.htaccess _deploy/.htaccess
      - name: Deploy ke.kandanews.africa
        uses: SamKirkland/FTP-Deploy-Action@v4.3.5
        with:
          server: ${{ secrets.FTP_HOST }}
          username: ${{ secrets.FTP_USER }}
          password: ${{ secrets.FTP_PASS }}
          local-dir: ./_deploy/
          server-dir: ke.kandanews.africa/public_html/

  deploy-za:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Prepare
        run: |
          mkdir -p _deploy/shared
          cp landing/coming-soon.php _deploy/index.php
          cp -r landing/shared/* _deploy/shared/
          cp landing/shared/.htaccess _deploy/.htaccess
      - name: Deploy za.kandanews.africa
        uses: SamKirkland/FTP-Deploy-Action@v4.3.5
        with:
          server: ${{ secrets.FTP_HOST }}
          username: ${{ secrets.FTP_USER }}
          password: ${{ secrets.FTP_PASS }}
          local-dir: ./_deploy/
          server-dir: za.kandanews.africa/public_html/

  deploy-ng:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Prepare
        run: |
          mkdir -p _deploy/shared
          cp landing/coming-soon.php _deploy/index.php
          cp -r landing/shared/* _deploy/shared/
          cp landing/shared/.htaccess _deploy/.htaccess
      - name: Deploy ng.kandanews.africa
        uses: SamKirkland/FTP-Deploy-Action@v4.3.5
        with:
          server: ${{ secrets.FTP_HOST }}
          username: ${{ secrets.FTP_USER }}
          password: ${{ secrets.FTP_PASS }}
          local-dir: ./_deploy/
          server-dir: ng.kandanews.africa/public_html/
